#! /usr/bin/python3
f = open('tap.gpio', 'r')

gpio = f.read().split()
RS = [] #25
D4 = [] #22
D5 = [] #18
D6 = [] #17
D7 = [] #23
E = []  #24
bit = []
enable = []
string = ''
lcd_1 = ['','','','','','','','','','','','','','','','']
lcd_2 = ['','','','','','','','','','','','','','','',''] 

def char_map(a,b):
	global string
	if a == ['LOW', 'LOW', 'HIGH', 'LOW']:
		if b == ['LOW', 'LOW', 'LOW', 'LOW']:
			string += (' ')

		elif b == ['LOW', 'LOW', 'LOW', 'HIGH']:
			string += ('!')

		elif b == ['LOW', 'LOW', 'HIGH', 'LOW']:
			string += ('\"')

		elif b == ['LOW', 'LOW', 'HIGH', 'HIGH']:
			string += ('#')

		elif b == ['LOW', 'HIGH', 'LOW', 'LOW']:
			string += ('$')

		elif b == ['LOW', 'HIGH', 'LOW', 'HIGH']:
			string += ('%')

		elif b == ['LOW', 'HIGH', 'HIGH', 'LOW']:
			string += ('&')

		elif b == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
			string += ('\'')

		elif b == ['HIGH', 'LOW', 'LOW', 'LOW']:
			string += ('(')

		elif b == ['HIGH', 'LOW', 'LOW', 'HIGH']:
			string += (')')

		elif b == ['HIGH', 'LOW', 'HIGH', 'LOW']:
			string += ('*')

		elif b == ['HIGH', 'LOW', 'HIGH', 'HIGH']:
			string += ('+')

		elif b == ['HIGH', 'HIGH', 'LOW', 'LOW']:
			string += (',')
			
		elif b == ['HIGH', 'HIGH', 'LOW', 'HIGH']:
			string += ('-')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'LOW']:
			string += ('.')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'HIGH']:
			string += ('/')
	elif a == ['LOW', 'LOW', 'HIGH', 'HIGH']:
		if b == ['LOW', 'LOW', 'LOW', 'LOW']:
			string += ('0')

		elif b == ['LOW', 'LOW', 'LOW', 'HIGH']:
			string += ('1')

		elif b == ['LOW', 'LOW', 'HIGH', 'LOW']:
			string += ('2')

		elif b == ['LOW', 'LOW', 'HIGH', 'HIGH']:
			string += ('3')

		elif b == ['LOW', 'HIGH', 'LOW', 'LOW']:
			string += ('4')

		elif b == ['LOW', 'HIGH', 'LOW', 'HIGH']:
			string += ('5')

		elif b == ['LOW', 'HIGH', 'HIGH', 'LOW']:
			string += ('6')

		elif b == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
			string += ('7')

		elif b == ['HIGH', 'LOW', 'LOW', 'LOW']:
			string += ('8')

		elif b == ['HIGH', 'LOW', 'LOW', 'HIGH']:
			string += ('9')

		elif b == ['HIGH', 'LOW', 'HIGH', 'LOW']:
			string += (':')

		elif b == ['HIGH', 'LOW', 'HIGH', 'HIGH']:
			string += (';')

		elif b == ['HIGH', 'HIGH', 'LOW', 'LOW']:
			string += ('<')
			
		elif b == ['HIGH', 'HIGH', 'LOW', 'HIGH']:
			string += ('=')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'LOW']:
			string += ('>')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'HIGH']:
			string += ('?')

	elif a == ['LOW', 'HIGH', 'LOW', 'LOW']: 
		if b == ['LOW', 'LOW', 'LOW', 'LOW']:
			string += ('@')

		elif b == ['LOW', 'LOW', 'LOW', 'HIGH']:
			string += ('A')

		elif b == ['LOW', 'LOW', 'HIGH', 'LOW']:
			string += ('B')

		elif b == ['LOW', 'LOW', 'HIGH', 'HIGH']:
			string += ('C')

		elif b == ['LOW', 'HIGH', 'LOW', 'LOW']:
			string += ('D')

		elif b == ['LOW', 'HIGH', 'LOW', 'HIGH']:
			string += ('E')

		elif b == ['LOW', 'HIGH', 'HIGH', 'LOW']:
			string += ('F')

		elif b == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
			string += ('G')

		elif b == ['HIGH', 'LOW', 'LOW', 'LOW']:
			string += ('H')

		elif b == ['HIGH', 'LOW', 'LOW', 'HIGH']:
			string += ('I')

		elif b == ['HIGH', 'LOW', 'HIGH', 'LOW']:
			string += ('J')

		elif b == ['HIGH', 'LOW', 'HIGH', 'HIGH']:
			string += ('K')

		elif b == ['HIGH', 'HIGH', 'LOW', 'LOW']:
			string += ('L')
			
		elif b == ['HIGH', 'HIGH', 'LOW', 'HIGH']:
			string += ('M')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'LOW']:
			string += ('N')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'HIGH']:
			string += ('O')

	elif a == ['LOW', 'HIGH', 'LOW', 'HIGH']:
		if b == ['LOW', 'LOW', 'LOW', 'LOW']:
			string += ('P')

		elif b == ['LOW', 'LOW', 'LOW', 'HIGH']:
			string += ('Q')

		elif b == ['LOW', 'LOW', 'HIGH', 'LOW']:
			string += ('R')

		elif b == ['LOW', 'LOW', 'HIGH', 'HIGH']:
			string += ('S')

		elif b == ['LOW', 'HIGH', 'LOW', 'LOW']:
			string += ('T')

		elif b == ['LOW', 'HIGH', 'LOW', 'HIGH']:
			string += ('U')

		elif b == ['LOW', 'HIGH', 'HIGH', 'LOW']:
			string += ('V')

		elif b == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
			string += ('W')

		elif b == ['HIGH', 'LOW', 'LOW', 'LOW']:
			string += ('X')

		elif b == ['HIGH', 'LOW', 'LOW', 'HIGH']:
			string += ('Y')

		elif b == ['HIGH', 'LOW', 'HIGH', 'LOW']:
			string += ('Z')

		elif b == ['HIGH', 'LOW', 'HIGH', 'HIGH']:
			string += ('[')

		elif b == ['HIGH', 'HIGH', 'LOW', 'LOW']:
			string += ('￥')
			
		elif b == ['HIGH', 'HIGH', 'LOW', 'HIGH']:
			string += (']')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'LOW']:
			string += ('^')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'HIGH']:
			string += ('_')

	elif a == ['LOW', 'HIGH', 'HIGH', 'LOW']:
		if b == ['LOW', 'LOW', 'LOW', 'LOW']:
			string += ('`')

		elif b == ['LOW', 'LOW', 'LOW', 'HIGH']:
			string += ('a')

		elif b == ['LOW', 'LOW', 'HIGH', 'LOW']:
			string += ('b')

		elif b == ['LOW', 'LOW', 'HIGH', 'HIGH']:
			string += ('c')

		elif b == ['LOW', 'HIGH', 'LOW', 'LOW']:
			string += ('d')

		elif b == ['LOW', 'HIGH', 'LOW', 'HIGH']:
			string += ('e')

		elif b == ['LOW', 'HIGH', 'HIGH', 'LOW']:
			string += ('f')

		elif b == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
			string += ('g')

		elif b == ['HIGH', 'LOW', 'LOW', 'LOW']:
			string += ('h')

		elif b == ['HIGH', 'LOW', 'LOW', 'HIGH']:
			string += ('i')

		elif b == ['HIGH', 'LOW', 'HIGH', 'LOW']:
			string += ('j')

		elif b == ['HIGH', 'LOW', 'HIGH', 'HIGH']:
			string += ('k')

		elif b == ['HIGH', 'HIGH', 'LOW', 'LOW']:
			string += ('l')
			
		elif b == ['HIGH', 'HIGH', 'LOW', 'HIGH']:
			string += ('m')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'LOW']:
			string += ('n')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'HIGH']:
			string += ('o')

	elif a == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
		if b == ['LOW', 'LOW', 'LOW', 'LOW']:
			string += ('p')

		elif b == ['LOW', 'LOW', 'LOW', 'HIGH']:
			string += ('q')

		elif b == ['LOW', 'LOW', 'HIGH', 'LOW']:
			string += ('r')

		elif b == ['LOW', 'LOW', 'HIGH', 'HIGH']:
			string += ('s')

		elif b == ['LOW', 'HIGH', 'LOW', 'LOW']:
			string += ('t')

		elif b == ['LOW', 'HIGH', 'LOW', 'HIGH']:
			string += ('u')

		elif b == ['LOW', 'HIGH', 'HIGH', 'LOW']:
			string += ('v')

		elif b == ['LOW', 'HIGH', 'HIGH', 'HIGH']:
			string += ('w')

		elif b == ['HIGH', 'LOW', 'LOW', 'LOW']:
			string += ('x')

		elif b == ['HIGH', 'LOW', 'LOW', 'HIGH']:
			string += ('y')

		elif b == ['HIGH', 'LOW', 'HIGH', 'LOW']:
			string += ('z')

		elif b == ['HIGH', 'LOW', 'HIGH', 'HIGH']:
			string += ('{')

		elif b == ['HIGH', 'HIGH', 'LOW', 'LOW']:
			string += ('|')
			
		elif b == ['HIGH', 'HIGH', 'LOW', 'HIGH']:
			string += ('}')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'LOW']:
			string += ('→')

		elif b == ['HIGH', 'HIGH', 'HIGH', 'HIGH']:
			string += ('←')

for x in range(len(gpio)):
	if gpio[x] == '24':
		E.append(gpio[x+2])
	elif gpio[x] == '25':
		RS.append(gpio[x+2])
	elif gpio[x] == '17':
		D6.append(gpio[x+2])
	elif gpio[x] == '18':
		D5.append(gpio[x+2])
	elif gpio[x] == '22':
		D4.append(gpio[x+2])
	elif gpio[x] == '23':
		D7.append(gpio[x+2])

for x in range(len(D4)):
	t = []
	t.append(D4[x])
	t.append(D5[x])
	t.append(D6[x])
	t.append(D7[x])
	
	bit.append(t)
for x in range(len(RS)):
	t = []
	t.append(E[3*x])
	t.append(E[3*x+1])
	t.append(E[3*x+2])
	enable.append(t)

	t =[]
	t.append(E[3*x+3])
	t.append(E[3*x+4])
	t.append(E[3*x+5])
	enable.append(t)

E = enable

index = 0
# command or data
for y in range(len(RS)):
	if E[2*y] == ['LOW', 'HIGH', 'LOW'] and E[2*y+1] == ['LOW', 'HIGH', 'LOW']:
		if RS[y] == 'HIGH': 
			# data write
			char_map(bit[2*y], bit[2*y+1])
			if RS[y-1] == 'LOW':
				if bit[2*(y-1)][0] == 'HIGH' and bit[2*(y-1)][1] == 'LOW': # switch cursor to the 1st line
					for i in range(len(bit[2*(y-1)+1])):
						if bit[2*(y-1)+1][i] == 'HIGH':
							index += 2**(-(i-3))
					lcd_1[index] = string[-1]
					index = 0
					string = string[:-1]

				elif bit[2*(y-1)][0] == 'HIGH' and bit[2*(y-1)][1] == 'HIGH': # switch cursor the 2nd line
					for i in range(len(bit[2*(y-1)+1])):
						if bit[2*(y-1)+1][i] == 'HIGH':
							index += 2**(-(i-3))
					lcd_2[index] = string[-1]
					index = 0
					string = string[:-1]
print(string)
lcd = ''.join(map(str,lcd_1))+''.join(map(str,lcd_2))
print(lcd)
